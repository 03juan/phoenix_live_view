!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.phoenix_live_view=t():e.phoenix_live_view=t()}(this,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){"use strict";var i;n.r(t);var r="http://www.w3.org/1999/xhtml",o="undefined"==typeof document?void 0:document;function u(e,t){var n=e.nodeName,i=t.nodeName;return n===i||!!(t.actualize&&n.charCodeAt(0)<91&&i.charCodeAt(0)>90)&&n===i.toUpperCase()}function a(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n))}var c={OPTION:function(e,t){a(e,t,"selected")},INPUT:function(e,t){a(e,t,"checked"),a(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var n=t.value;e.value!==n&&(e.value=n);var i=e.firstChild;if(i){var r=i.nodeValue;if(r==n||!n&&r==e.placeholder)return;i.nodeValue=n}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var n=0,i=t.firstChild;i;){var r=i.nodeName;if(r&&"OPTION"===r.toUpperCase()){if(i.hasAttribute("selected"))break;n++}i=i.nextSibling}e.selectedIndex=n}}},s=1,l=3,d=8;function f(){}function h(e){return e.id}var v=function(e){return function(t,n,a){if(a||(a={}),"string"==typeof n)if("#document"===t.nodeName||"HTML"===t.nodeName){var v=n;(n=o.createElement("html")).innerHTML=v}else n=function(e){var t;return!i&&o.createRange&&(i=o.createRange()).selectNode(o.body),i&&i.createContextualFragment?t=i.createContextualFragment(e):(t=o.createElement("body")).innerHTML=e,t.childNodes[0]}(n);var p,y=a.getNodeKey||h,b=a.onBeforeNodeAdded||f,m=a.onNodeAdded||f,g=a.onBeforeElUpdated||f,w=a.onElUpdated||f,A=a.onBeforeNodeDiscarded||f,k=a.onNodeDiscarded||f,x=a.onBeforeElChildrenUpdated||f,E=!0===a.childrenOnly,S={};function C(e){p?p.push(e):p=[e]}function N(e,t,n){!1!==A(e)&&(t&&t.removeChild(e),k(e),function e(t,n){if(t.nodeType===s)for(var i=t.firstChild;i;){var r=void 0;n&&(r=y(i))?C(r):(k(i),i.firstChild&&e(i,n)),i=i.nextSibling}}(e,n))}function T(e){m(e);for(var t=e.firstChild;t;){var n=t.nextSibling,i=y(t);if(i){var r=S[i];r&&u(t,r)&&(t.parentNode.replaceChild(r,t),L(r,t))}T(t),t=n}}function L(i,r,a){var f,h=y(r);if(h&&delete S[h],!n.isSameNode||!n.isSameNode(t)){if(!a){if(!1===g(i,r))return;if(e(i,r),w(i),!1===x(i,r))return}if("TEXTAREA"!==i.nodeName){var v,p,m,A,k=r.firstChild,E=i.firstChild;e:for(;k;){for(m=k.nextSibling,v=y(k);E;){if(p=E.nextSibling,k.isSameNode&&k.isSameNode(E)){k=m,E=p;continue e}f=y(E);var V=E.nodeType,B=void 0;if(V===k.nodeType&&(V===s?(v?v!==f&&((A=S[v])?E.nextSibling===A?B=!1:(i.insertBefore(A,E),p=E.nextSibling,f?C(f):N(E,i,!0),E=A):B=!1):f&&(B=!1),(B=!1!==B&&u(E,k))&&L(E,k)):V!==l&&V!=d||(B=!0,E.nodeValue!==k.nodeValue&&(E.nodeValue=k.nodeValue))),B){k=m,E=p;continue e}f?C(f):N(E,i,!0),E=p}if(v&&(A=S[v])&&u(A,k))i.appendChild(A),L(A,k);else{var I=b(k);!1!==I&&(I&&(k=I),k.actualize&&(k=k.actualize(i.ownerDocument||o)),i.appendChild(k),T(k))}k=m,E=p}for(;E;)p=E.nextSibling,(f=y(E))?C(f):N(E,i,!0),E=p}var O=c[i.nodeName];O&&O(i,r)}}!function e(t){if(t.nodeType===s)for(var n=t.firstChild;n;){var i=y(n);i&&(S[i]=n),e(n),n=n.nextSibling}}(t);var V=t,B=V.nodeType,I=n.nodeType;if(!E)if(B===s)I===s?u(t,n)||(k(t),V=function(e,t){for(var n=e.firstChild;n;){var i=n.nextSibling;t.appendChild(n),n=i}return t}(t,function(e,t){return t&&t!==r?o.createElementNS(t,e):o.createElement(e)}(n.nodeName,n.namespaceURI))):V=n;else if(B===l||B===d){if(I===B)return V.nodeValue!==n.nodeValue&&(V.nodeValue=n.nodeValue),V;V=n}if(V===n)k(t);else if(L(V,n,E),p)for(var O=0,j=p.length;O<j;O++){var P=S[p[O]];P&&N(P,P.parentNode,!1)}return!E&&V!==t&&t.parentNode&&(V.actualize&&(V=V.actualize(t.ownerDocument||o)),t.parentNode.replaceChild(V,t)),V}}(function(e,t){var n,i,r,o,u,a=t.attributes;for(n=a.length-1;n>=0;--n)r=(i=a[n]).name,o=i.namespaceURI,u=i.value,o?(r=i.localName||r,e.getAttributeNS(o,r)!==u&&e.setAttributeNS(o,r,u)):e.getAttribute(r)!==u&&e.setAttribute(r,u);for(n=(a=e.attributes).length-1;n>=0;--n)!1!==(i=a[n]).specified&&(r=i.name,(o=i.namespaceURI)?(r=i.localName||r,t.hasAttributeNS(o,r)||e.removeAttributeNS(o,r)):t.hasAttribute(r)||e.removeAttribute(r))});function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(i=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function m(e,t,n){return t&&b(e.prototype,t),n&&b(e,n),e}function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.d(t,"debug",function(){return S}),n.d(t,"Rendered",function(){return L}),n.d(t,"LiveSocket",function(){return V}),n.d(t,"Browser",function(){return B}),n.d(t,"View",function(){return O});var w="data-phx-view",A="[".concat(w,"]"),k=["text","textarea","number","email","password","search","tel","url"],x=100,E="phx-",S=function(e,t,n,i){console.log("".concat(e.id," ").concat(t,": ").concat(n," - "),i)},C=function(e){return"object"===g(e)&&!(e instanceof Array)},N=function(e,t){return e?e[t]:null},T=function(e){return new URLSearchParams(new FormData(e)).toString()},L={mergeDiff:function(e,t){return this.isNewFingerprint(t)?t:(function e(t,n){for(var i in n){var r=n[i];C(r)&&t[i]?e(t[i],r):t[i]=r}}(e,t),e)},isNewFingerprint:function(){return!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).static},toString:function(e){var t={buffer:""};return this.toOutputBuffer(e,t),t.buffer},toOutputBuffer:function(e,t){if(e.dynamics)return this.comprehensionToBuffer(e,t);var n=e.static;t.buffer+=n[0];for(var i=1;i<n.length;i++)this.dynamicToBuffer(e[i-1],t),t.buffer+=n[i]},comprehensionToBuffer:function(e,t){for(var n=e.dynamics,i=e.static,r=0;r<n.length;r++){var o=n[r];t.buffer+=i[0];for(var u=1;u<i.length;u++)this.dynamicToBuffer(o[u-1],t),t.buffer+=i[u]}},dynamicToBuffer:function(e,t){C(e)?this.toOutputBuffer(e,t):t.buffer+=e}},V=function(){function e(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};y(this,e),this.unloaded=!1;var r=window.Phoenix.Socket;this.socket=new r(t,i),this.socket.onOpen(function(){n.isUnloaded()&&(n.destroyAllViews(),n.joinRootViews()),n.unloaded=!1}),window.addEventListener("beforeunload",function(e){n.unloaded=!0}),this.bindingPrefix=i.bindingPrefix||E,this.opts=i,this.views={},this.viewLogger=i.viewLogger,this.activeElement=null,this.prevActive=null,this.silenced=!1,this.bindTopLevelEvents()}return m(e,[{key:"isUnloaded",value:function(){return this.unloaded}},{key:"getSocket",value:function(){return this.socket}},{key:"log",value:function(e,t,n){if(this.viewLogger){var i=p(n(),2),r=i[0],o=i[1];this.viewLogger(e,t,r,o)}}},{key:"connect",value:function(){var e=this;return["complete","loaded","interactive"].indexOf(document.readyState)>=0?this.joinRootViews():document.addEventListener("DOMContentLoaded",function(){e.joinRootViews()}),this.socket.connect()}},{key:"getBindingPrefix",value:function(){return this.bindingPrefix}},{key:"binding",value:function(e){return"".concat(this.getBindingPrefix()).concat(e)}},{key:"disconnect",value:function(){this.socket.disconnect()}},{key:"channel",value:function(e,t){return this.socket.channel(e,t||{})}},{key:"joinRootViews",value:function(){var e=this;document.querySelectorAll("".concat(A,":not([").concat("data-phx-parent-id","])")).forEach(function(t){e.joinView(t)})}},{key:"joinView",value:function(e,t){if(!this.getViewById(e.id)){var n=new O(e,this,t);this.views[n.id]=n,n.join()}}},{key:"owner",value:function(e,t){var n=this.getViewById(N(e.closest(A),"id"));n&&t(n)}},{key:"getViewById",value:function(e){return this.views[e]}},{key:"onViewError",value:function(e){this.dropActiveElement(e)}},{key:"destroyAllViews",value:function(){for(var e in this.views)this.destroyViewById(e)}},{key:"destroyViewById",value:function(e){var t=this.views[e];t&&(delete this.views[t.id],t.destroy())}},{key:"setActiveElement",value:function(e){var t=this;if(this.activeElement!==e){this.activeElement=e;var n=function(){e===t.activeElement&&(t.activeElement=null),e.removeEventListener("mouseup",t),e.removeEventListener("touchend",t)};e.addEventListener("mouseup",n),e.addEventListener("touchend",n)}}},{key:"getActiveElement",value:function(){return document.activeElement===document.body&&this.activeElement||document.activeElement}},{key:"dropActiveElement",value:function(e){this.prevActive&&e.ownsElement(this.prevActive)&&(this.prevActive=null)}},{key:"restorePreviouslyActiveFocus",value:function(){this.prevActive&&this.prevActive!==document.body&&this.prevActive.focus()}},{key:"blurActiveElement",value:function(){this.prevActive=this.getActiveElement(),this.prevActive!==document.body&&this.prevActive.blur()}},{key:"bindTopLevelEvents",value:function(){this.bindClicks(),this.bindForms(),this.bindTargetable({keyup:"keyup",keydown:"keydown"},function(e,t,n,i,r,o){n.pushKey(i,t,e,r)}),this.bindTargetable({blur:"focusout",focus:"focusin"},function(e,t,n,i,r,o){o||n.pushEvent(t,i,r)}),this.bindTargetable({blur:"blur",focus:"focus"},function(e,t,n,i,r,o){o&&"window"!==!o&&n.pushEvent(t,i,r)})}},{key:"bindTargetable",value:function(e,t){var n=this,i=function(i){var r=e[i];n.on(r,function(e){var r=n.binding(i),o=n.binding("target"),u=e.target.getAttribute&&e.target.getAttribute(r);u&&!e.target.getAttribute(o)?n.owner(e.target,function(n){return t(e,i,n,e.target,u,null)}):document.querySelectorAll("[".concat(r,"][").concat(o,"=window]")).forEach(function(o){var u=o.getAttribute(r);n.owner(o,function(n){return t(e,i,n,o,u,"window")})})})};for(var r in e)i(r)}},{key:"bindClicks",value:function(){var e=this;window.addEventListener("click",function(t){var n=e.binding("click"),i=function(e,t){do{if(e.matches("[".concat(t,"]")))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType&&!e.matches(A));return null}(t.target,n),r=i&&i.getAttribute(n);r&&(t.preventDefault(),e.owner(i,function(e){return e.pushEvent("click",i,r)}))},!1)}},{key:"bindForms",value:function(){var e=this;this.on("submit",function(t){var n=t.target.getAttribute(e.binding("submit"));n&&(t.preventDefault(),t.target.disabled=!0,e.owner(t.target,function(e){return e.submitForm(t.target,n)}))},!1);for(var t=["change","input"],n=function(){var n=t[i];e.on(n,function(t){var i=t.target;if("input"!==n||!["checkbox","radio","select-one","select-multiple"].includes(i.type)){var r=i.form&&i.form.getAttribute(e.binding("change"));r&&e.owner(i,function(t){I.isTextualInput(i)?i.setAttribute("data-phx-has-focused",!0):e.setActiveElement(i),t.pushInput(i,r)})}},!1)},i=0;i<t.length;i++)n()}},{key:"silenceEvents",value:function(e){this.silenced=!0,e(),this.silenced=!1}},{key:"on",value:function(e,t){var n=this;window.addEventListener(e,function(e){n.silenced||t(e)})}}]),e}(),B={setCookie:function(e,t){document.cookie="".concat(e,"=").concat(t)},getCookie:function(e){return document.cookie.replace(new RegExp("(?:(?:^|.*;s*)".concat(e,"s*=s*([^;]*).*$)|^.*$")),"$1")},redirect:function(e,t){t&&B.setCookie("__phoenix_flash__",t+"; max-age=60000; path=/"),window.location=e}},I={disableForm:function(e,t){var n="".concat(t).concat("disable-with");e.classList.add("phx-loading"),e.querySelectorAll("[".concat(n,"]")).forEach(function(e){var t=e.getAttribute(n);e.setAttribute("".concat(n,"-restore"),e.innerText),e.innerText=t}),e.querySelectorAll("button").forEach(function(e){e.setAttribute("data-phx-disabled",e.disabled),e.disabled=!0}),e.querySelectorAll("input").forEach(function(e){e.setAttribute("data-phx-readonly",e.readOnly),e.readOnly=!0})},restoreDisabledForm:function(e,t){var n="".concat(t).concat("disable-with");e.classList.remove("phx-loading"),e.querySelectorAll("[".concat(n,"]")).forEach(function(e){var t=e.getAttribute("".concat(n,"-restore"));t&&(e.innerText=t,e.removeAttribute("".concat(n,"-restore")))}),e.querySelectorAll("button").forEach(function(e){var t=e.getAttribute("data-phx-disabled");t&&(e.disabled="true"===t,e.removeAttribute("data-phx-disabled"))}),e.querySelectorAll("input").forEach(function(e){var t=e.getAttribute("data-phx-readonly");t&&(e.readOnly="true"===t,e.removeAttribute("data-phx-readonly"))})},discardError:function(e){var t=e.getAttribute&&e.getAttribute("data-phx-error-for");if(t){var n=document.getElementById(t);!t||n.getAttribute("data-phx-has-focused")||n.form.getAttribute("data-phx-has-submitted")||(e.style.display="none")}},isPhxChild:function(e){return e.getAttribute&&e.getAttribute("data-phx-parent-id")},patch:function(e,t,n,i){var r=e.liveSocket.getActiveElement(),o=null,u=null;I.isTextualInput(r)&&(o=r.selectionStart,u=r.selectionEnd),v(t,"<div>".concat(i,"</div>"),{childrenOnly:!0,onBeforeNodeAdded:function(e){return I.discardError(e),e},onNodeAdded:function(t){if(I.isPhxChild(t)&&e.ownsElement(t))return e.onNewChildAdded(t),!0},onBeforeNodeDiscarded:function(t){if(I.isPhxChild(t))return e.liveSocket.destroyViewById(t.id),!0},onBeforeElUpdated:function(e,t){return I.isPhxChild(t)?(I.mergeAttrs(e,t),!1):(e.getAttribute&&e.getAttribute("data-phx-has-submitted")&&t.setAttribute("data-phx-has-submitted",!0),e.getAttribute&&e.getAttribute("data-phx-has-focused")&&t.setAttribute("data-phx-has-focused",!0),I.discardError(t),!I.isTextualInput(e)||e!==r||(I.mergeInputs(e,t),!1))}}),e.liveSocket.silenceEvents(function(){I.restoreFocus(r,o,u)}),document.dispatchEvent(new Event("phx:update"))},mergeAttrs:function(e,t){t.getAttributeNames().forEach(function(n){var i=t.getAttribute(n);e.setAttribute(n,i)})},mergeInputs:function(e,t){I.mergeAttrs(e,t),e.readOnly=t.readOnly},restoreFocus:function(e,t,n){I.isTextualInput(e)&&((""===e.value||e.readOnly)&&e.blur(),e.focus(),(e.setSelectionRange&&"text"===e.type||"textarea"===e.type)&&e.setSelectionRange(t,n))},isTextualInput:function(e){return k.indexOf(e.type)>=0}},O=function(){function e(t,n,i){var r=this;y(this,e),this.liveSocket=n,this.parent=i,this.newChildrenAdded=!1,this.gracefullyClosed=!1,this.el=t,this.loader=this.el.nextElementSibling,this.id=this.el.id,this.view=this.el.getAttribute(w),this.channel=this.liveSocket.channel("lv:".concat(this.id),function(){return{session:r.getSession()}}),this.loaderTimer=setTimeout(function(){return r.showLoader()},x),this.bindChannel()}return m(e,[{key:"getSession",value:function(){return this.el.getAttribute("data-phx-session")}},{key:"destroy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this.hasGracefullyClosed()?(this.log("destroyed",function(){return["the server view has gracefully closed"]}),e()):(this.log("destroyed",function(){return["the child has been removed from the parent"]}),this.channel.leave().receive("ok",e).receive("error",e).receive("timeout",e))}},{key:"hideLoader",value:function(){clearTimeout(this.loaderTimer),this.loader.style.display="none"}},{key:"showLoader",value:function(){clearTimeout(this.loaderTimer),this.el.classList="phx-disconnected",this.loader.style.display="block";var e=Math.floor(this.el.clientHeight/2);this.loader.style.top="-".concat(e,"px")}},{key:"log",value:function(e,t){this.liveSocket.log(this,e,t)}},{key:"onJoin",value:function(e){var t=e.rendered;this.log("join",function(){return["",JSON.stringify(t)]}),this.rendered=t,this.hideLoader(),this.el.classList="phx-connected",I.patch(this,this.el,this.id,L.toString(this.rendered)),this.joinNewChildren()}},{key:"joinNewChildren",value:function(){var e=this,t="".concat(A,"[").concat("data-phx-parent-id",'="').concat(this.id,'"]');document.querySelectorAll(t).forEach(function(t){e.liveSocket.getViewById(t.id)||e.liveSocket.joinView(t,e)})}},{key:"update",value:function(e){if(!function(e){return 0===Object.keys(e).length}(e)){this.log("update",function(){return["",JSON.stringify(e)]}),this.rendered=L.mergeDiff(this.rendered,e);var t=L.toString(this.rendered);this.newChildrenAdded=!1,I.patch(this,this.el,this.id,t),this.newChildrenAdded&&this.joinNewChildren()}}},{key:"onNewChildAdded",value:function(e){this.newChildrenAdded=!0}},{key:"bindChannel",value:function(){var e=this;this.channel.on("render",function(t){return e.update(t)}),this.channel.on("redirect",function(e){var t=e.to,n=e.flash;return B.redirect(t,n)}),this.channel.on("session",function(t){var n=t.token;return e.el.setAttribute("data-phx-session",n)}),this.channel.onError(function(t){return e.onError(t)}),this.channel.onClose(function(){return e.onGracefulClose()})}},{key:"onGracefulClose",value:function(){this.gracefullyClosed=!0,this.liveSocket.destroyViewById(this.id)}},{key:"hasGracefullyClosed",value:function(){return this.gracefullyClosed}},{key:"join",value:function(){var e=this;this.parent&&(this.parent.channel.onClose(function(){return e.onGracefulClose()}),this.parent.channel.onError(function(){return e.liveSocket.destroyViewById(e.id)})),this.channel.join().receive("ok",function(t){return e.onJoin(t)}).receive("error",function(t){return e.onJoinError(t)}).receive("timeout",function(){return e.onJoinError("timeout")})}},{key:"onJoinError",value:function(e){this.displayError(),this.log("error",function(){return["unable to join",e]})}},{key:"onError",value:function(e){this.log("error",function(){return["view crashed",e]}),this.liveSocket.onViewError(this),document.activeElement.blur(),this.liveSocket.isUnloaded()?this.showLoader():this.displayError()}},{key:"displayError",value:function(){this.showLoader(),this.el.classList="".concat("phx-disconnected"," ").concat("phx-error")}},{key:"pushWithReply",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this.channel.push(e,t,2e4).receive("ok",function(e){n.update(e),i()})}},{key:"pushEvent",value:function(e,t,n){var i=t.getAttribute(this.binding("value"))||t.value||"";this.pushWithReply("event",{type:e,event:n,value:i})}},{key:"pushKey",value:function(e,t,n,i){this.pushWithReply("event",{type:t,event:i,value:e.value||n.key})}},{key:"pushInput",value:function(e,t){this.pushWithReply("event",{type:"form",event:t,value:T(e.form)})}},{key:"pushFormSubmit",value:function(e,t,n){this.pushWithReply("event",{type:"form",event:t,value:T(e)},n)}},{key:"ownsElement",value:function(e){return e.getAttribute("data-phx-parent-id")===this.id||N(e.closest(A),"id")===this.id}},{key:"submitForm",value:function(e,t){var n=this,i=this.liveSocket.getBindingPrefix();e.setAttribute("data-phx-has-submitted","true"),I.disableForm(e,i),this.liveSocket.blurActiveElement(this),this.pushFormSubmit(e,t,function(){I.restoreDisabledForm(e,i),n.liveSocket.restorePreviouslyActiveFocus()})}},{key:"binding",value:function(e){return this.liveSocket.binding(e)}}]),e}();t.default=V},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){(function(t){t.Phoenix||(t.Phoenix={}),e.exports=t.Phoenix.LiveView=n(0)}).call(this,n(1))}])});